{% extends "base.html" %}

{% block title %}Molecular Data - CMLRE Marine Data Platform{% endblock %}

{% block content %}
<div class="dashboard-container">
    <h1>üß¨ Real-time Molecular Biodiversity Data</h1>
    <p>Live eDNA analysis, genetic barcoding, and AI-powered species identification</p>

    <div class="filters">
        <div class="filter-group">
            <label for="markerFilter">Genetic Marker</label>
            <select id="markerFilter">
                <option value="all">All Markers</option>
                {% for marker in markers %}
                <option value="{{ marker }}">{{ marker }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="filter-group">
            <label for="speciesFilter">Species</label>
            <select id="speciesFilter">
                <option value="all">All Species</option>
                {% for sp in species %}
                <option value="{{ sp }}">{{ sp }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="filter-group">
            <label for="timeFilter">Time Range</label>
            <select id="timeFilter">
                <option value="realtime">Real-time (Last 24h)</option>
                <option value="7days">Last 7 Days</option>
                <option value="30days">Last 30 Days</option>
                <option value="all">All Data</option>
            </select>
        </div>
    </div>

    <!-- Real-time Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number" id="species-count">{{ species|length }}</div>
            <p>Species Barcoded</p>
            <small class="stat-trend">‚Üë 2 this week</small>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="records-count">{{ total_records }}</div>
            <p>Genetic Records</p>
            <small class="stat-trend">+124 today</small>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="markers-count">{{ markers|length }}</div>
            <p>Genetic Markers</p>
            <small>Active markers</small>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="completion-rate">92%</div>
            <p>Barcode Completion</p>
            <small class="stat-trend">‚Üë 3% this month</small>
        </div>
    </div>

    <!-- Real-time Alerts -->
    <div class="alert-banner info">
        <span class="alert-icon">üî¨</span>
        <span class="alert-text"><strong>Live Sequencing:</strong> 3 samples currently processing. Expected completion: <span id="sequencing-time">15:30</span></span>
        <button class="alert-close" onclick="this.parentElement.style.display='none'">√ó</button>
    </div>

    <div class="dashboard-grid">
        <div class="card chart-card">
            <div class="card-header">
                <h3>üß¨ Genetic Marker Distribution</h3>
                <span class="last-updated" id="marker-update"></span>
            </div>
            <div class="chart-container">
                <canvas id="molecularChart"></canvas>
            </div>
            <div class="chart-legend" id="marker-legend">
                <!-- Dynamic legend will be inserted here -->
            </div>
        </div>
        
        <div class="card chart-card">
            <div class="card-header">
                <h3>üåä eDNA Detection Profile</h3>
                <span class="last-updated" id="edna-update"></span>
            </div>
            <div class="chart-container">
                <canvas id="ednaChart"></canvas>
            </div>
            <div class="detection-stats">
                <div class="detection-item">
                    <span class="detection-label">Avg Concentration:</span>
                    <span class="detection-value" id="avg-concentration">-- ng/ŒºL</span>
                </div>
                <div class="detection-item">
                    <span class="detection-label">Detection Rate:</span>
                    <span class="detection-value" id="detection-rate">--%</span>
                </div>
            </div>
        </div>

        <div class="card chart-card">
            <div class="card-header">
                <h3>üìà Sequencing Trends</h3>
                <span class="last-updated" id="trends-update"></span>
            </div>
            <div class="chart-container">
                <canvas id="sequencingChart"></canvas>
            </div>
            <div class="trend-info">
                <p>üìä <strong>Weekly throughput:</strong> <span id="weekly-throughput">--</span> samples</p>
                <p>‚ö° <strong>Success rate:</strong> <span id="success-rate">--%</span></p>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3>ü§ñ AI Species Identification</h3>
                <span class="last-updated" id="ai-update"></span>
            </div>
            <div id="ai-results">
                <div class="ai-result-item">
                    <span class="ai-species">Thunnus albacares</span>
                    <span class="ai-confidence">98.7%</span>
                </div>
                <div class="ai-result-item">
                    <span class="ai-species">Rastrelliger kanagurta</span>
                    <span class="ai-confidence">95.2%</span>
                </div>
                <div class="ai-result-item">
                    <span class="ai-species">Sardinella longiceps</span>
                    <span class="ai-confidence">92.8%</span>
                </div>
            </div>
            <button id="run-ai-analysis" class="btn" style="width: 100%; margin-top: 1rem;">
                üöÄ Run AI Identification
            </button>
        </div>
    </div>

    <!-- Real-time Data Table -->
    <div class="card">
        <div class="card-header">
            <h3>üìã Live Molecular Data Stream</h3>
            <div class="table-controls">
                <button id="refresh-table" class="btn-small">üîÑ Refresh</button>
                <span class="last-updated" id="table-update"></span>
            </div>
        </div>
        <div class="table-container">
            <table class="data-table" id="molecular-table">
                <thead>
                    <tr>
                        <th>Sample ID</th>
                        <th>Species</th>
                        <th>Genetic Marker</th>
                        <th>Sequence Length</th>
                        <th>eDNA Concentration</th>
                        <th>Status</th>
                        <th>Confidence</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody id="molecular-data-body">
                    {% for record in molecular_data %}
                    <tr class="data-row" data-species="{{ record.species }}" data-marker="{{ record.genetic_marker }}">
                        <td><code class="sample-id">{{ record.sample_id }}</code></td>
                        <td><strong>{{ record.species }}</strong></td>
                        <td><span class="marker-tag">{{ record.genetic_marker }}</span></td>
                        <td>{{ record.sequence_length }} bp</td>
                        <td>{{ "%.2f"|format(record.edna_concentration) }} ng/ŒºL</td>
                        <td>
                            <span class="status-badge status-{{ record.barcode_status|lower|replace(' ', '-') }}">
                                {{ record.barcode_status }}
                            </span>
                        </td>
                        <td>
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: {{ record.confidence * 100 }}%"></div>
                                <span class="confidence-text">{{ "%.1f"|format(record.confidence * 100) }}%</span>
                            </div>
                        </td>
                        <td class="timestamp">{{ record.collection_date }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="table-footer">
            <span id="row-count">Showing {{ molecular_data|length }} records</span>
            <div class="pagination">
                <button class="btn-small" id="prev-page">‚Üê Previous</button>
                <span class="page-info">Page 1 of 1</span>
                <button class="btn-small" id="next-page">Next ‚Üí</button>
            </div>
        </div>
    </div>

    <!-- AI Correlation Analysis -->
    <div class="card">
        <h3>üîç AI-Powered Correlation Analysis</h3>
        <div class="correlation-grid">
            <div class="correlation-item">
                <h4>eDNA vs Temperature</h4>
                <div class="correlation-value positive">r = 0.87</div>
                <p>Higher temperatures correlate with increased eDNA detection</p>
            </div>
            <div class="correlation-item">
                <h4>Marker Diversity vs Species</h4>
                <div class="correlation-value positive">r = 0.92</div>
                <p>Multiple markers improve species identification accuracy</p>
            </div>
            <div class="correlation-item">
                <h4>Sequence Length vs Confidence</h4>
                <div class="correlation-value positive">r = 0.78</div>
                <p>Longer sequences yield higher confidence identifications</p>
            </div>
        </div>
        <button id="run-correlation-analysis" class="btn">
            ü§ñ Run Advanced Correlation Analysis
        </button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// Real-time Molecular Data Dashboard
class MolecularDashboard {
    constructor() {
        this.charts = {};
        this.currentData = [];
        this.initializeCharts();
        this.startRealTimeUpdates();
        this.setupEventListeners();
    }

    initializeCharts() {
        this.initializeMolecularChart();
        this.initializeEdnaChart();
        this.initializeSequencingChart();
    }

    initializeMolecularChart() {
        const ctx = document.getElementById('molecularChart').getContext('2d');
        this.charts.molecular = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['COI', '16S rRNA', '12S rRNA', 'cytb', '18S rRNA'],
                datasets: [{
                    data: [35, 25, 20, 15, 5],
                    backgroundColor: [
                        '#3182ce', '#38b2ac', '#48bb78', '#ed8936', '#805ad5'
                    ],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { 
                            font: { size: 12 },
                            boxWidth: 12
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: ${context.raw}%`;
                            }
                        }
                    }
                }
            }
        });
    }

    initializeEdnaChart() {
        const ctx = document.getElementById('ednaChart').getContext('2d');
        this.charts.edna = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['Tuna', 'Mackerel', 'Sardine', 'Pomfret', 'Shark', 'Crab', 'Lobster'],
                datasets: [{
                    label: 'eDNA Concentration',
                    data: [85, 92, 78, 65, 45, 55, 35],
                    backgroundColor: 'rgba(56, 178, 172, 0.2)',
                    borderColor: 'rgba(56, 178, 172, 1)',
                    pointBackgroundColor: 'rgba(56, 178, 172, 1)',
                    borderWidth: 2,
                    pointBorderColor: '#fff',
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        angleLines: { display: true },
                        suggestedMin: 0,
                        suggestedMax: 100,
                        ticks: { 
                            stepSize: 20,
                            backdropColor: 'transparent'
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }

    initializeSequencingChart() {
        const ctx = document.getElementById('sequencingChart').getContext('2d');
        this.charts.sequencing = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Samples Processed',
                    data: [45, 52, 48, 60, 55, 35, 42],
                    borderColor: '#3182ce',
                    backgroundColor: 'rgba(49, 130, 206, 0.1)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: '#3182ce',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { 
                            display: true, 
                            text: 'Samples',
                            color: '#666'
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }

    setupEventListeners() {
        // Filter functionality
        document.getElementById('markerFilter').addEventListener('change', () => this.applyFilters());
        document.getElementById('speciesFilter').addEventListener('change', () => this.applyFilters());
        document.getElementById('timeFilter').addEventListener('change', () => this.applyFilters());

        // AI Analysis buttons
        document.getElementById('run-ai-analysis').addEventListener('click', () => this.runAIAnalysis());
        document.getElementById('run-correlation-analysis').addEventListener('click', () => this.runCorrelationAnalysis());

        // Table controls
        document.getElementById('refresh-table').addEventListener('click', () => this.refreshTable());

        // Pagination
        document.getElementById('prev-page').addEventListener('click', () => this.previousPage());
        document.getElementById('next-page').addEventListener('click', () => this.nextPage());

        // Window resize for responsive charts
        window.addEventListener('resize', () => this.handleResize());
    }

    handleResize() {
        // Re-render charts on resize for better responsiveness
        Object.values(this.charts).forEach(chart => {
            if (chart) {
                chart.resize();
            }
        });
    }

    startRealTimeUpdates() {
        // Update charts every 30 seconds
        setInterval(() => this.updateCharts(), 30000);
        
        // Update table data every minute
        setInterval(() => this.updateTableData(), 60000);
        
        // Update timestamps every 10 seconds
        setInterval(() => this.updateTimestamps(), 10000);

        // Initial updates
        this.updateTimestamps();
        this.simulateRealTimeData();
    }

    updateTimestamps() {
        const now = new Date().toLocaleString();
        document.querySelectorAll('.last-updated').forEach(el => {
            el.textContent = `Updated: ${now}`;
        });
    }

    async updateCharts() {
        // Simulate real-time data updates
        this.simulateChartData();
        
        // Update detection stats
        this.updateDetectionStats();
    }

    simulateChartData() {
        if (this.charts.molecular) {
            // Add some randomness to marker distribution
            const newData = this.charts.molecular.data.datasets[0].data.map(value => 
                Math.max(5, value + Math.random() * 10 - 5)
            );
            this.charts.molecular.data.datasets[0].data = newData;
            this.charts.molecular.update('none'); // 'none' for performance
        }

        if (this.charts.edna) {
            // Update eDNA concentrations
            const newData = this.charts.edna.data.datasets[0].data.map(value => 
                Math.max(10, value + Math.random() * 20 - 10)
            );
            this.charts.edna.data.datasets[0].data = newData;
            this.charts.edna.update('none');
        }

        if (this.charts.sequencing) {
            // Update sequencing trends
            const newData = this.charts.sequencing.data.datasets[0].data.map(value => 
                Math.max(10, value + Math.random() * 15 - 7)
            );
            this.charts.sequencing.data.datasets[0].data = newData;
            this.charts.sequencing.update('none');
        }
    }

    updateDetectionStats() {
        const avgConcentration = (85 + 92 + 78 + 65 + 45 + 55 + 35) / 7;
        document.getElementById('avg-concentration').textContent = `${avgConcentration.toFixed(1)} ng/ŒºL`;
        
        const detectionRate = ((7 - 1) / 7 * 100).toFixed(1);
        document.getElementById('detection-rate').textContent = `${detectionRate}%`;

        // Update weekly throughput
        const throughput = this.charts.sequencing.data.datasets[0].data.reduce((a, b) => a + b, 0);
        document.getElementById('weekly-throughput').textContent = throughput;

        // Update success rate
        const successRate = ((throughput - 5) / throughput * 100).toFixed(1);
        document.getElementById('success-rate').textContent = `${successRate}%`;
    }

    async applyFilters() {
        const markerFilter = document.getElementById('markerFilter').value;
        const speciesFilter = document.getElementById('speciesFilter').value;
        const timeFilter = document.getElementById('timeFilter').value;

        // Show loading state
        const tableBody = document.getElementById('molecular-data-body');
        tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 2rem;">üîç Filtering data...</td></tr>';

        // Simulate API call with filters
        setTimeout(() => {
            this.filterTableData(markerFilter, speciesFilter, timeFilter);
        }, 1000);
    }

    filterTableData(marker, species, timeRange) {
        const rows = document.querySelectorAll('.data-row');
        let visibleCount = 0;

        rows.forEach(row => {
            const rowMarker = row.dataset.marker;
            const rowSpecies = row.dataset.species;
            
            const markerMatch = marker === 'all' || rowMarker === marker;
            const speciesMatch = species === 'all' || rowSpecies === species;
            
            if (markerMatch && speciesMatch) {
                row.style.display = '';
                visibleCount++;
            } else {
                row.style.display = 'none';
            }
        });

        document.getElementById('row-count').textContent = `Showing ${visibleCount} records`;
    }

    async runAIAnalysis() {
        const button = document.getElementById('run-ai-analysis');
        const originalText = button.innerHTML;
        
        button.innerHTML = 'üß† Analyzing...';
        button.disabled = true;

        // Simulate AI processing
        await new Promise(resolve => setTimeout(resolve, 3000));

        // Update AI results
        const aiResults = document.getElementById('ai-results');
        aiResults.innerHTML = `
            <div class="ai-result-item new">
                <span class="ai-species">Thunnus albacares</span>
                <span class="ai-confidence">99.1%</span>
            </div>
            <div class="ai-result-item new">
                <span class="ai-species">Rastrelliger kanagurta</span>
                <span class="ai-confidence">96.8%</span>
            </div>
            <div class="ai-result-item new">
                <span class="ai-species">Sardinella longiceps</span>
                <span class="ai-confidence">94.2%</span>
            </div>
            <div class="ai-result-item new">
                <span class="ai-species">Pampus argenteus</span>
                <span class="ai-confidence">91.5%</span>
            </div>
        `;

        button.innerHTML = originalText;
        button.disabled = false;

        // Show success message
        this.showNotification('AI analysis completed successfully!', 'success');
    }

    async runCorrelationAnalysis() {
        const button = document.getElementById('run-correlation-analysis');
        const originalText = button.innerHTML;
        
        button.innerHTML = 'ü§ñ Running correlation analysis...';
        button.disabled = true;

        // Simulate correlation analysis
        await new Promise(resolve => setTimeout(resolve, 2000));

        // Update correlation values with new analysis
        const correlations = document.querySelectorAll('.correlation-value');
        correlations.forEach(corr => {
            const currentValue = parseFloat(corr.textContent.split('=')[1]);
            const newValue = Math.min(0.99, Math.max(0.5, currentValue + (Math.random() * 0.1 - 0.05)));
            corr.textContent = `r = ${newValue.toFixed(2)}`;
        });

        button.innerHTML = originalText;
        button.disabled = false;

        this.showNotification('Correlation analysis updated with latest data!', 'success');
    }

    refreshTable() {
        const button = document.getElementById('refresh-table');
        button.innerHTML = 'üîÑ Refreshing...';
        
        setTimeout(() => {
            this.simulateRealTimeData();
            button.innerHTML = 'üîÑ Refresh';
            this.showNotification('Table data refreshed!', 'info');
        }, 1500);
    }

    previousPage() {
        this.showNotification('Previous page loaded', 'info');
    }

    nextPage() {
        this.showNotification('Next page loaded', 'info');
    }

    simulateRealTimeData() {
        // Add a new row to simulate real-time data
        const tableBody = document.getElementById('molecular-data-body');
        const newRow = this.generateNewDataRow();
        tableBody.insertBefore(newRow, tableBody.firstChild);

        // Update row count
        const rowCount = tableBody.querySelectorAll('tr').length;
        document.getElementById('row-count').textContent = `Showing ${rowCount} records`;

        // Remove oldest row if we have too many
        if (rowCount > 20) {
            tableBody.removeChild(tableBody.lastChild);
        }
    }

    generateNewDataRow() {
        const markers = ['COI', '16S rRNA', '12S rRNA', 'cytb', '18S rRNA'];
        const species = ['Thunnus albacares', 'Rastrelliger kanagurta', 'Sardinella longiceps', 'Pampus argenteus'];
        const statuses = ['Valid', 'Verified', 'Pending'];
        
        const row = document.createElement('tr');
        row.className = 'data-row new-entry';
        row.dataset.species = species[Math.floor(Math.random() * species.length)];
        row.dataset.marker = markers[Math.floor(Math.random() * markers.length)];
        
        const sampleId = `MLRE${Math.floor(Math.random() * 90000) + 10000}`;
        const concentration = (Math.random() * 8 + 0.5).toFixed(2);
        const confidence = (Math.random() * 0.15 + 0.85).toFixed(3);
        const status = statuses[Math.floor(Math.random() * statuses.length)];
        
        row.innerHTML = `
            <td><code class="sample-id">${sampleId}</code></td>
            <td><strong>${row.dataset.species}</strong></td>
            <td><span class="marker-tag">${row.dataset.marker}</span></td>
            <td>${Math.floor(Math.random() * 1500) + 500} bp</td>
            <td>${concentration} ng/ŒºL</td>
            <td><span class="status-badge status-${status.toLowerCase()}">${status}</span></td>
            <td>
                <div class="confidence-bar">
                    <div class="confidence-fill" style="width: ${parseFloat(confidence) * 100}%"></div>
                    <span class="confidence-text">${(parseFloat(confidence) * 100).toFixed(1)}%</span>
                </div>
            </td>
            <td class="timestamp">${new Date().toLocaleString()}</td>
        `;

        // Remove new-entry class after animation
        setTimeout(() => row.classList.remove('new-entry'), 2000);

        return row;
    }

    showNotification(message, type = 'info') {
        // Remove existing notifications
        document.querySelectorAll('.notification').forEach(notif => notif.remove());

        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <span class="notification-icon">${type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è'}</span>
            <span class="notification-text">${message}</span>
            <button class="notification-close" onclick="this.parentElement.remove()">√ó</button>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            if (notification.parentElement) {
                notification.remove();
            }
        }, 5000);
    }

    updateTableData() {
        this.simulateRealTimeData();
        this.updateTimestamps();
    }
}

// Initialize dashboard when page loads
document.addEventListener('DOMContentLoaded', function() {
    window.molecularDashboard = new MolecularDashboard();
});

// Utility functions
function exportMolecularData() {
    window.molecularDashboard.showNotification('Preparing data export...', 'info');
}

function generateReport() {
    window.molecularDashboard.showNotification('Generating comprehensive report...', 'info');
}
</script>

<style>
/* Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
    color: #333;
    background-color: #f8fafc;
}

.dashboard-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 1rem;
}

/* Typography */
h1 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    color: #2d3748;
}

h3 {
    font-size: 1.2rem;
    margin-bottom: 0.5rem;
    color: #2d3748;
}

/* Cards */
.card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
    border: 1px solid #e2e8f0;
}

.chart-card {
    min-height: 400px;
    display: flex;
    flex-direction: column;
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.card-header h3 {
    margin: 0;
}

/* Filters */
.filters {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin: 1.5rem 0;
    padding: 1rem;
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.filter-group {
    display: flex;
    flex-direction: column;
}

.filter-group label {
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #4a5568;
}

.filter-group select {
    padding: 0.5rem;
    border: 1px solid #cbd5e0;
    border-radius: 6px;
    font-size: 0.9rem;
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin: 1.5rem 0;
}

.stat-card {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border-left: 4px solid #3182ce;
}

.stat-number {
    font-size: 2rem;
    font-weight: bold;
    color: #3182ce;
    margin-bottom: 0.5rem;
}

.stat-trend {
    color: #48bb78;
    font-weight: 600;
}

/* Dashboard Grid */
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 1.5rem;
    margin: 1.5rem 0;
}

/* Charts */
.chart-container {
    position: relative;
    height: 250px;
    width: 100%;
    flex-grow: 1;
}

/* Alert Banner */
.alert-banner {
    display: flex;
    align-items: center;
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
    background: rgba(56, 178, 172, 0.1);
    border-left: 4px solid #38b2ac;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.alert-banner.info {
    background: rgba(49, 130, 206, 0.1);
    border-left-color: #3182ce;
}

.alert-icon {
    font-size: 1.2rem;
}

.alert-close {
    background: none;
    border: none;
    font-size: 1.2rem;
    cursor: pointer;
    margin-left: auto;
}

/* Detection Stats */
.detection-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-top: 1rem;
}

.detection-item {
    background: rgba(255, 255, 255, 0.5);
    padding: 0.75rem;
    border-radius: 6px;
    text-align: center;
    border: 1px solid #e2e8f0;
}

.detection-label {
    display: block;
    font-size: 0.8rem;
    color: #666;
}

.detection-value {
    display: block;
    font-weight: bold;
    font-size: 1.1rem;
    color: #3182ce;
}

/* AI Results */
.ai-result-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    margin: 0.5rem 0;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 6px;
    border-left: 3px solid #48bb78;
}

.ai-result-item.new {
    animation: highlight 2s ease-in-out;
}

.ai-confidence {
    font-weight: bold;
    color: #48bb78;
}

/* Correlation Grid */
.correlation-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    margin: 1rem 0;
}

.correlation-item {
    padding: 1rem;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 8px;
    text-align: center;
    border: 1px solid #e2e8f0;
}

.correlation-value {
    font-size: 1.5rem;
    font-weight: bold;
    margin: 0.5rem 0;
}

.correlation-value.positive { color: #48bb78; }

/* Table Styles */
.table-container {
    overflow-x: auto;
    margin: 1rem 0;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
}

.data-table th {
    background: #f7fafc;
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    color: #4a5568;
    border-bottom: 2px solid #e2e8f0;
}

.data-table td {
    padding: 1rem;
    border-bottom: 1px solid #e2e8f0;
}

.data-table tr:hover {
    background: #f7fafc;
}

/* Status Badges */
.status-badge {
    padding: 0.3rem 0.75rem;
    border-radius: 20px;
    color: white;
    font-size: 0.8rem;
    font-weight: bold;
    white-space: nowrap;
}

.status-valid { background: #48bb78; }
.status-verified { background: #3182ce; }
.status-pending { background: #ed8936; }

/* Confidence Bar */
.confidence-bar {
    position: relative;
    background: #e2e8f0;
    border-radius: 10px;
    height: 20px;
    overflow: hidden;
    min-width: 80px;
}

.confidence-fill {
    height: 100%;
    background: linear-gradient(90deg, #48bb78, #38b2ac);
    transition: width 0.5s ease;
}

.confidence-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 0.7rem;
    font-weight: bold;
    color: #2d3748;
}

/* Buttons */
.btn {
    padding: 0.75rem 1.5rem;
    background: #3182ce;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 600;
    transition: background 0.3s ease;
}

.btn:hover {
    background: #2c5aa0;
}

.btn-small {
    padding: 0.5rem 1rem;
    font-size: 0.8rem;
}

.btn:disabled {
    background: #a0aec0;
    cursor: not-allowed;
}

/* Table Controls */
.table-controls {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.table-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 1rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.pagination {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

/* Notifications */
.notification {
    position: fixed;
    top: 100px;
    right: 20px;
    padding: 1rem;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    z-index: 1000;
    animation: slideIn 0.3s ease-out;
    border-left: 4px solid #3182ce;
}

.notification.success {
    border-left-color: #48bb78;
}

.notification-close {
    background: none;
    border: none;
    font-size: 1.2rem;
    cursor: pointer;
    margin-left: 0.5rem;
}

/* Animations */
@keyframes highlight {
    0% { background: rgba(72, 187, 120, 0.3); }
    100% { background: rgba(255, 255, 255, 0.5); }
}

@keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

.new-entry {
    animation: highlight-row 2s ease-in-out;
}

@keyframes highlight-row {
    0% { background: rgba(56, 178, 172, 0.3); }
    100% { background: transparent; }
}

/* Responsive Design */
@media (max-width: 768px) {
    .dashboard-container {
        padding: 0.5rem;
    }
    
    h1 {
        font-size: 1.5rem;
    }
    
    .filters {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .dashboard-grid {
        grid-template-columns: 1fr;
    }
    
    .card-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .table-footer {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .data-table {
        font-size: 0.8rem;
    }
    
    .data-table th,
    .data-table td {
        padding: 0.5rem;
    }
    
    .notification {
        right: 10px;
        left: 10px;
        top: 80px;
    }
}

@media (max-width: 480px) {
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .detection-stats {
        grid-template-columns: 1fr;
    }
    
    .correlation-grid {
        grid-template-columns: 1fr;
    }
    
    .table-controls {
        flex-direction: column;
        align-items: flex-start;
    }
}

/* Utility Classes */
.last-updated {
    font-size: 0.8rem;
    color: #666;
    white-space: nowrap;
}

.marker-tag {
    padding: 0.2rem 0.5rem;
    background: #edf2f7;
    border-radius: 4px;
    font-family: monospace;
    font-size: 0.8rem;
    white-space: nowrap;
}

.sample-id {
    font-family: monospace;
    background: #f7fafc;
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
    font-size: 0.8rem;
}

.timestamp {
    white-space: nowrap;
    font-size: 0.8rem;
    color: #666;
}
</style>
{% endblock %}